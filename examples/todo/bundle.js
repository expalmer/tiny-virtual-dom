(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx h */
const { h, patch } = require('../../lib');

var DATAS = [{
  task: 'Read a good book',
  done: false
}, {
  task: 'Learn Javascript',
  done: false
}, {
  task: 'Learn Haskell',
  done: false
}];

// Events
const onAddTask = event => {
  const { value } = event.target;
  if (event.keyCode === 13 && value) {
    DATAS = [{ task: value, done: false }, ...DATAS];
    event.target.value = '';
    render();
  }
};

const onToggleTask = index => {
  DATAS = DATAS.map((i, idx) => {
    if (index === idx) {
      i.done = !i.done;
    }
    return i;
  });
  render();
};

const onRemoveTask = index => {
  DATAS = DATAS.filter((i, idx) => index !== idx);
  render();
};

// Elements
const Input = props => {
  return h(
    'div',
    { className: 'insert' },
    h('input', { type: 'text', placeholder: 'What needs to be done?', onkeyup: onAddTask })
  );
};

const Item = props => {
  const { item, index } = props;
  return h(
    'li',
    { className: `todo${item.done ? ' done' : ''}` },
    h(
      'span',
      { onclick: () => onToggleTask(index) },
      item.task
    ),
    h('button', { className: 'destroy', onclick: () => onRemoveTask(index) })
  );
};

const List = props => {
  const { datas } = props;
  return h(
    'ul',
    { className: 'list' },
    datas.map((item, index) => h(Item, { item: item, index: index }))
  );
};

const App = props => {
  return h(
    'div',
    null,
    h(
      'h1',
      null,
      'To Do List'
    ),
    h(Input, null),
    h(List, { datas: props.datas })
  );
};

var currentTree;

function render() {
  const nextTree = h(App, { datas: DATAS });
  patch(document.getElementById('app'), nextTree, currentTree);
  currentTree = nextTree;
}

render();

},{"../../lib":3}],2:[function(require,module,exports){
function isObject(x) {
  return typeof x === "object" && x !== null;
}

function isFunction(x) {
  return typeof x === "function";
}

function isString(x) {
  return typeof x === "string";
}

function isUndefined(x) {
  return x === undefined;
}

const isArray = Array.isArray || function (obj) {
  return Object.prototype.toString.call(obj) === "[object Array]";
};

function head(x) {
  return isString(x) ? x.charAt(0) : x[0];
}

module.exports = {
  isObject,
  isFunction,
  isArray,
  isString,
  isUndefined,
  head
};

},{}],3:[function(require,module,exports){
const {
  isArray,
  isObject,
  isFunction,
  isString,
  isUndefined,
  head
} = require('./helpers');

function h(type, props, ...children) {
  if (isFunction(type)) {
    return type(props);
  }
  if (isArray(head(children))) {
    children = head(children);
  }
  return { type, props: props || {}, children };
}

function createElement(node) {
  if (!isObject(node)) {
    return document.createTextNode(String(node));
  }
  const $el = document.createElement(node.type);
  applyProps($el, node.props);
  node.children.map(child => $el.appendChild(createElement(child)));
  return $el;
}

function patch($parent, newTree, oldTree, index = 0) {
  if (!oldTree) {
    $parent.appendChild(createElement(newTree));
  }if (!newTree) {
    removeChildren($parent, index);
  } else if (changed(newTree, oldTree)) {
    $parent.replaceChild(createElement(newTree), $parent.childNodes[index]);
  } else if (!isUndefined(newTree.type)) {
    applyProps($parent.childNodes[index], newTree.props, oldTree.props);
    patchNodes($parent, newTree, oldTree, index);
  }
}

function changed(a, b) {
  return typeof a !== typeof b || isString(a) && a !== b || a.type !== b.type;
}

function patchNodes($parent, newTree, oldTree, index) {
  const len = Math.max(newTree.children.length, oldTree.children.length);
  let i = -1;
  while (++i < len) {
    patch($parent.childNodes[index], newTree.children[i], oldTree.children[i], i);
  }
}

function removeChildren($parent, index) {
  let times = ($parent.childNodes.length || 0) - index;
  while (times-- > 0) {
    if ($parent.lastChild) {
      $parent.removeChild($parent.lastChild);
    }
  }
}

function applyProps($el, newProps, oldProps = {}) {
  const props = Object.assign({}, newProps, oldProps);
  Object.keys(props).map(name => {
    const newValue = newProps[name];
    const oldValue = oldProps[name];
    if (!newValue) {
      removeProp($el, name, newValue);
    } else if (newValue !== oldValue) {
      setProp($el, name, newValue);
    }
  });
}

function setProp($el, name, value) {
  if (name === 'className') {
    $el.setAttribute('class', value);
  } else {
    if (isObject(value)) {
      for (let x in value) {
        let xValue = value[x] || "";
        $el[name][x] = xValue;
      }
    } else {
      $el[name] = value;
    }
  }
}

function removeProp($el, name, value) {
  if (name === 'className') {
    $el.removeAttribute('class');
  } else {
    if (isObject(value)) {
      for (let x in value) {
        delete $el[name][x];
      }
    } else {
      delete $el[name];
    }
  }
}

module.exports = {
  h,
  patch
};

},{"./helpers":2}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlcy90b2RvL2luZGV4LmpzIiwibGliL2hlbHBlcnMuanMiLCJsaWIvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBLE1BQU0sRUFBRSxDQUFGLEVBQUssS0FBTCxLQUFlLFFBQVEsV0FBUixDQUFyQjs7QUFFQSxJQUFJLFFBQVEsQ0FDVjtBQUNFLFFBQU0sa0JBRFI7QUFFRSxRQUFNO0FBRlIsQ0FEVSxFQUtWO0FBQ0UsUUFBTSxrQkFEUjtBQUVFLFFBQU07QUFGUixDQUxVLEVBU1Y7QUFDRSxRQUFNLGVBRFI7QUFFRSxRQUFNO0FBRlIsQ0FUVSxDQUFaOztBQWVBO0FBQ0EsTUFBTSxZQUFZLFNBQVM7QUFDekIsUUFBTSxFQUFFLEtBQUYsS0FBWSxNQUFNLE1BQXhCO0FBQ0EsTUFBSSxNQUFNLE9BQU4sS0FBa0IsRUFBbEIsSUFBd0IsS0FBNUIsRUFBbUM7QUFDakMsWUFBUSxDQUFDLEVBQUUsTUFBTSxLQUFSLEVBQWUsTUFBTSxLQUFyQixFQUFELEVBQStCLEdBQUcsS0FBbEMsQ0FBUjtBQUNBLFVBQU0sTUFBTixDQUFhLEtBQWIsR0FBcUIsRUFBckI7QUFDQTtBQUNEO0FBQ0YsQ0FQRDs7QUFTQSxNQUFNLGVBQWUsU0FBUztBQUM1QixVQUFRLE1BQU0sR0FBTixDQUFVLENBQUMsQ0FBRCxFQUFJLEdBQUosS0FBWTtBQUM1QixRQUFJLFVBQVUsR0FBZCxFQUFtQjtBQUNqQixRQUFFLElBQUYsR0FBUyxDQUFDLEVBQUUsSUFBWjtBQUNEO0FBQ0QsV0FBTyxDQUFQO0FBQ0QsR0FMTyxDQUFSO0FBTUE7QUFDRCxDQVJEOztBQVVBLE1BQU0sZUFBZSxTQUFTO0FBQzVCLFVBQVEsTUFBTSxNQUFOLENBQWEsQ0FBQyxDQUFELEVBQUksR0FBSixLQUFZLFVBQVUsR0FBbkMsQ0FBUjtBQUNBO0FBQ0QsQ0FIRDs7QUFLQTtBQUNBLE1BQU0sUUFB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cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqIEBqc3ggaCAqL1xuY29uc3QgeyBoLCBwYXRjaCB9ID0gcmVxdWlyZSgnLi4vLi4vbGliJyk7XG5cbnZhciBEQVRBUyA9IFtcbiAge1xuICAgIHRhc2s6ICdSZWFkIGEgZ29vZCBib29rJyxcbiAgICBkb25lOiBmYWxzZVxuICB9LFxuICB7XG4gICAgdGFzazogJ0xlYXJuIEphdmFzY3JpcHQnLFxuICAgIGRvbmU6IGZhbHNlXG4gIH0sXG4gIHtcbiAgICB0YXNrOiAnTGVhcm4gSGFza2VsbCcsXG4gICAgZG9uZTogZmFsc2VcbiAgfVxuXTtcblxuLy8gRXZlbnRzXG5jb25zdCBvbkFkZFRhc2sgPSBldmVudCA9PiB7XG4gIGNvbnN0IHsgdmFsdWUgfSA9IGV2ZW50LnRhcmdldDtcbiAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzICYmIHZhbHVlKSB7XG4gICAgREFUQVMgPSBbeyB0YXNrOiB2YWx1ZSwgZG9uZTogZmFsc2UgfSwgLi4uREFUQVNdO1xuICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnO1xuICAgIHJlbmRlcigpO1xuICB9XG59O1xuXG5jb25zdCBvblRvZ2dsZVRhc2sgPSBpbmRleCA9PiB7XG4gIERBVEFTID0gREFUQVMubWFwKChpLCBpZHgpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IGlkeCkge1xuICAgICAgaS5kb25lID0gIWkuZG9uZTtcbiAgICB9XG4gICAgcmV0dXJuIGk7XG4gIH0pO1xuICByZW5kZXIoKTtcbn07XG5cbmNvbnN0IG9uUmVtb3ZlVGFzayA9IGluZGV4ID0+IHtcbiAgREFUQVMgPSBEQVRBUy5maWx0ZXIoKGksIGlkeCkgPT4gaW5kZXggIT09IGlkeCk7XG4gIHJlbmRlcigpO1xufTtcblxuLy8gRWxlbWVudHNcbmNvbnN0IElucHV0ID0gcHJvcHMgPT4ge1xuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwiaW5zZXJ0XCI+XG4gICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIldoYXQgbmVlZHMgdG8gYmUgZG9uZT9cIiBvbmtleXVwPXtvbkFkZFRhc2t9IC8+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5jb25zdCBJdGVtID0gcHJvcHMgPT4ge1xuICBjb25zdCB7IGl0ZW0sIGluZGV4IH0gPSBwcm9wcztcbiAgcmV0dXJuIChcbiAgICA8bGkgY2xhc3NOYW1lPXtgdG9kbyR7aXRlbS5kb25lID8gJyBkb25lJyA6ICcnfWB9PlxuICAgICAgPHNwYW4gb25jbGljaz17KCkgPT4gb25Ub2dnbGVUYXNrKGluZGV4KX0+e2l0ZW0udGFza308L3NwYW4+XG4gICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImRlc3Ryb3lcIiBvbmNsaWNrPXsoKSA9PiBvblJlbW92ZVRhc2soaW5kZXgpfT48L2J1dHRvbj5cbiAgICA8L2xpPlxuICApO1xufTtcblxuY29uc3QgTGlzdCA9IHByb3BzID0+IHtcbiAgY29uc3QgeyBkYXRhcyB9ID0gcHJvcHM7XG4gIHJldHVybiAoXG4gICAgPHVsIGNsYXNzTmFtZT1cImxpc3RcIj5cbiAgICAgIHtkYXRhcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiA8SXRlbSBpdGVtPXtpdGVtfSBpbmRleD17aW5kZXh9IC8+KX1cbiAgICA8L3VsPlxuICApO1xufTtcblxuY29uc3QgQXBwID0gcHJvcHMgPT4ge1xuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8aDE+VG8gRG8gTGlzdDwvaDE+XG4gICAgICA8SW5wdXQgLz5cbiAgICAgIDxMaXN0IGRhdGFzPXtwcm9wcy5kYXRhc30gLz5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cblxudmFyIGN1cnJlbnRUcmVlO1xuXG5mdW5jdGlvbiByZW5kZXIoKSB7XG4gIGNvbnN0IG5leHRUcmVlID0gPEFwcCBkYXRhcz17REFUQVN9IC8+O1xuICBwYXRjaChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwJyksIG5leHRUcmVlLCBjdXJyZW50VHJlZSk7XG4gIGN1cnJlbnRUcmVlID0gbmV4dFRyZWU7XG59XG5cbnJlbmRlcigpO1xuIiwiZnVuY3Rpb24gaXNPYmplY3QoeCkge1xuICByZXR1cm4gdHlwZW9mIHggPT09IFwib2JqZWN0XCIgJiYgeCAhPT0gbnVsbDtcbn1cblxuZnVuY3Rpb24gaXNGdW5jdGlvbih4KSB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJmdW5jdGlvblwiO1xufVxuXG5mdW5jdGlvbiBpc1N0cmluZyh4KSB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJzdHJpbmdcIjtcbn1cblxuZnVuY3Rpb24gaXNVbmRlZmluZWQoeCkge1xuICByZXR1cm4geCA9PT0gdW5kZWZpbmVkO1xufVxuXG5jb25zdCBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSBcIltvYmplY3QgQXJyYXldXCI7XG59XG5cbmZ1bmN0aW9uIGhlYWQoeCkge1xuICByZXR1cm4gaXNTdHJpbmcoeCkgPyB4LmNoYXJBdCgwKSA6IHhbMF07XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBpc09iamVjdCxcbiAgaXNGdW5jdGlvbixcbiAgaXNBcnJheSxcbiAgaXNTdHJpbmcsXG4gIGlzVW5kZWZpbmVkLFxuICBoZWFkLFxufSIsImNvbnN0IHtcbiAgaXNBcnJheSxcbiAgaXNPYmplY3QsXG4gIGlzRnVuY3Rpb24sXG4gIGlzU3RyaW5nLFxuICBpc1VuZGVmaW5lZCxcbiAgaGVhZCxcbn0gPSByZXF1aXJlKCcuL2hlbHBlcnMnKTtcblxuZnVuY3Rpb24gaCh0eXBlLCBwcm9wcywgLi4uY2hpbGRyZW4pIHtcbiAgaWYgKGlzRnVuY3Rpb24odHlwZSkpIHtcbiAgICByZXR1cm4gdHlwZShwcm9wcyk7XG4gIH1cbiAgaWYgKGlzQXJyYXkoaGVhZChjaGlsZHJlbikpKSB7XG4gICAgY2hpbGRyZW4gPSBoZWFkKGNoaWxkcmVuKTtcbiAgfVxuICByZXR1cm4geyB0eXBlLCBwcm9wczogcHJvcHMgfHwge30sIGNoaWxkcmVuIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQobm9kZSkge1xuICBpZiAoIWlzT2JqZWN0KG5vZGUpKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFN0cmluZyhub2RlKSk7XG4gIH1cbiAgY29uc3QgJGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChub2RlLnR5cGUpO1xuICBhcHBseVByb3BzKCRlbCwgbm9kZS5wcm9wcyk7XG4gIG5vZGUuY2hpbGRyZW4ubWFwKGNoaWxkID0+ICRlbC5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KGNoaWxkKSkpO1xuICByZXR1cm4gJGVsO1xufVxuXG5mdW5jdGlvbiBwYXRjaCgkcGFyZW50LCBuZXdUcmVlLCBvbGRUcmVlLCBpbmRleCA9IDApIHtcbiAgaWYgKCFvbGRUcmVlKSB7XG4gICAgJHBhcmVudC5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KG5ld1RyZWUpKTtcbiAgfSBpZiAoIW5ld1RyZWUpIHtcbiAgICByZW1vdmVDaGlsZHJlbigkcGFyZW50LCBpbmRleCk7XG4gIH0gZWxzZSBpZiAoY2hhbmdlZChuZXdUcmVlLCBvbGRUcmVlKSkge1xuICAgICRwYXJlbnQucmVwbGFjZUNoaWxkKGNyZWF0ZUVsZW1lbnQobmV3VHJlZSksICRwYXJlbnQuY2hpbGROb2Rlc1tpbmRleF0pO1xuICB9IGVsc2UgaWYgKCFpc1VuZGVmaW5lZChuZXdUcmVlLnR5cGUpKSB7XG4gICAgYXBwbHlQcm9wcygkcGFyZW50LmNoaWxkTm9kZXNbaW5kZXhdLCBuZXdUcmVlLnByb3BzLCBvbGRUcmVlLnByb3BzKTtcbiAgICBwYXRjaE5vZGVzKCRwYXJlbnQsIG5ld1RyZWUsIG9sZFRyZWUsIGluZGV4KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjaGFuZ2VkKGEsIGIpIHtcbiAgcmV0dXJuICh0eXBlb2YgYSAhPT0gdHlwZW9mIGIpIHx8IChpc1N0cmluZyhhKSAmJiBhICE9PSBiKSB8fCAoYS50eXBlICE9PSBiLnR5cGUpIDtcbn1cblxuZnVuY3Rpb24gcGF0Y2hOb2RlcygkcGFyZW50LCBuZXdUcmVlLCBvbGRUcmVlLCBpbmRleCkge1xuICBjb25zdCBsZW4gPSBNYXRoLm1heChuZXdUcmVlLmNoaWxkcmVuLmxlbmd0aCwgb2xkVHJlZS5jaGlsZHJlbi5sZW5ndGgpO1xuICBsZXQgaSA9IC0xO1xuICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgcGF0Y2goXG4gICAgICAkcGFyZW50LmNoaWxkTm9kZXNbaW5kZXhdLFxuICAgICAgbmV3VHJlZS5jaGlsZHJlbltpXSxcbiAgICAgIG9sZFRyZWUuY2hpbGRyZW5baV0sXG4gICAgICBpXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVDaGlsZHJlbigkcGFyZW50LCBpbmRleCkge1xuICBsZXQgdGltZXMgPSAoJHBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aCB8fCAwKSAtIGluZGV4O1xuICB3aGlsZSAodGltZXMtLSA+IDApIHtcbiAgICBpZiAoJHBhcmVudC5sYXN0Q2hpbGQpIHtcbiAgICAgICRwYXJlbnQucmVtb3ZlQ2hpbGQoJHBhcmVudC5sYXN0Q2hpbGQpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBhcHBseVByb3BzKCRlbCwgbmV3UHJvcHMsIG9sZFByb3BzID0ge30pIHtcbiAgY29uc3QgcHJvcHMgPSBPYmplY3QuYXNzaWduKHt9LCBuZXdQcm9wcywgb2xkUHJvcHMpXG4gIE9iamVjdC5rZXlzKHByb3BzKS5tYXAobmFtZSA9PiB7XG4gICAgY29uc3QgbmV3VmFsdWUgPSBuZXdQcm9wc1tuYW1lXTtcbiAgICBjb25zdCBvbGRWYWx1ZSA9IG9sZFByb3BzW25hbWVdXG4gICAgaWYgKCFuZXdWYWx1ZSkge1xuICAgICAgcmVtb3ZlUHJvcCgkZWwsIG5hbWUsIG5ld1ZhbHVlKTtcbiAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xuICAgICAgc2V0UHJvcCgkZWwsIG5hbWUsIG5ld1ZhbHVlKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzZXRQcm9wKCRlbCwgbmFtZSwgdmFsdWUpIHtcbiAgaWYgKG5hbWUgPT09ICdjbGFzc05hbWUnKSB7XG4gICAgJGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCB2YWx1ZSk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgZm9yIChsZXQgeCBpbiB2YWx1ZSkge1xuICAgICAgICBsZXQgeFZhbHVlID0gdmFsdWVbeF0gfHwgXCJcIjtcbiAgICAgICAgJGVsW25hbWVdW3hdID0geFZhbHVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAkZWxbbmFtZV0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlUHJvcCgkZWwsIG5hbWUsIHZhbHVlKSB7XG4gIGlmIChuYW1lID09PSAnY2xhc3NOYW1lJykge1xuICAgICRlbC5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgZm9yIChsZXQgeCBpbiB2YWx1ZSkge1xuICAgICAgICBkZWxldGUgJGVsW25hbWVdW3hdO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgJGVsW25hbWVdO1xuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgaCxcbiAgcGF0Y2gsXG59O1xuIl19
